{"version":3,"file":"vue.js","sources":["../src/observer/dep.js","../src/observer/index.js","../src/observer/watcher.js","../src/index.js"],"sourcesContent":["export default class Dep {\r\n    subs = [] // 存放当前的依赖 watcher 实例\r\n    constructor(){\r\n\r\n    }\r\n    // 添加依赖\r\n    addSub(){\r\n    }\r\n\r\n    // 收集依赖\r\n    depend(){\r\n        if(Dep.target){\r\n            this.subs.push(Dep.target)\r\n        }\r\n    }\r\n\r\n    // 通知依赖\r\n    notify(newValue,oldValue){\r\n        for (const watcher of this.subs) {\r\n            watcher.update(newValue,oldValue)\r\n        }\r\n    }\r\n}","import Dep from \"./dep\";\r\n\r\nfunction defineReactive(obj, key, val, cb) {\r\n    const dep = new Dep()\r\n  // obj中的每一个key 都有 闭包val\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      console.log(`观察：在获取${obj}的值${key}`);\r\n      dep.depend()\r\n      return val;\r\n    },\r\n    set(newValue,oldValue) {\r\n      console.log(`观察：在这里改变了${val}`);\r\n      // 新值旧值一样不触发\r\n      if(newValue === val) return\r\n      val = newValue;\r\n      cb && cb(val);\r\n    \r\n      // 当数据发生变化的时候，通知收集好的所有依赖，将最新的值传过来\r\n      dep.notify(newValue)\r\n    },\r\n  });\r\n}\r\n\r\nexport class Observer {\r\n  dep;\r\n  constructor(data) {\r\n    this.dep = new Dep()\r\n    this.walk(data);\r\n  }\r\n  // 方法\r\n  walk(data) {\r\n    for (const [key, value] of Object.entries(data)) {\r\n      defineReactive(data, key, value);\r\n    }\r\n  }\r\n}\r\n\r\nexport function observe(data, cb) {\r\n  return new Observer(data);\r\n}\r\n","import Dep from './dep.js';\r\n\r\nexport default class watcher {\r\n    vm;\r\n    exp;\r\n    cb;\r\n    constructor(vm,exp,cb){\r\n        this.vm = vm\r\n        this.exp = exp\r\n        this.cb = cb\r\n        this.get()\r\n    }\r\n    get(){\r\n        // 先把watcher 存到一个公共的地方\r\n        Dep.target = this\r\n        const _data = this.vm._data\r\n        // _data[this.exp] 触发 =》get => dep.depend() =>\r\n        const value = _data[this.exp]\r\n        // 收集完成之后清空\r\n        Dep.target = null \r\n        return value\r\n    }\r\n    // 给Dep的notify\r\n    update(newValue,oldValue) {\r\n        this.cb && this.cb(this.vm,newValue,oldValue)\r\n    }\r\n}","import { observe } from \"./observer/index\";\r\nimport Watcher from \"./observer/watcher\";\r\n\r\n// 代理,代理这里是不可以defineReactive()会导致取值复制失效\r\n// 此处代理\r\nfunction _proxy(data) {\r\n  // 箭头函数内的this,是外层的this\r\n  //   Object.keys(data).forEach((key) => {\r\n  //     Object.defineProperty(this, key, {\r\n  //       get() {\r\n  //         console.log(`代理对象获取${data[key]}`)\r\n  //         return data[key];\r\n  //       },\r\n  //       set(newData) {\r\n  //         // 这里是一定要data[key]\r\n  //         data[key] = newData;\r\n  //         console.log(\"代理:值改变\", data[key]);\r\n  //       },\r\n  //     });\r\n  //   });\r\n  for (const key of Object.keys(data)) {\r\n    Object.defineProperty(this, key, {\r\n      get() {\r\n        console.log(`代理对象获取${data[key]}`);\r\n        return data[key];\r\n      },\r\n      set(newData) {\r\n        // 这里是一定要data[key]\r\n        data[key] = newData;\r\n        console.log(\"代理:值改变\", data[key]);\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nfunction initData(vm) {\r\n  // 观察_data上的键值存取操作\r\n  observe(vm._data);\r\n  // 数据代理，可以通过实例直接访问\r\n  _proxy.call(vm, vm._data);\r\n}\r\n\r\nfunction initWatch(vm,watch){\r\n    if(watch){\r\n      const entries = Object.entries(watch)\r\n      console.log('打印他的enti',  entries.length);\r\n      for (const [key,value] of entries) {\r\n          new Watcher(vm,key,value)\r\n      }\r\n    }\r\n}\r\n\r\n// vue 用function，不用class的原因，function可枚举\r\nfunction Vue(options) {\r\n  const vm = this;\r\n  vm.$options = options;\r\n  vm._data = typeof options.data === \"function\" ? options.data(): options.data;\r\n \r\n  initData(vm); // 直接调用this指向window,用call改变this\r\n  initWatch(vm,options.watch); // 以传参的方式是不需要改变call的指向\r\n \r\n}\r\n\r\n// 这里 function 不能用箭头函数，箭头函数向上找this 这里的是 window,\r\nVue.prototype.$watch = function(exp,cb) {\r\n    new Watcher(this,exp,cb)\r\n}\r\n\r\nexport default Vue;\r\n"],"names":["Dep","subs","constructor","addSub","depend","target","push","notify","newValue","oldValue","watcher","update","defineReactive","obj","key","val","cb","dep","Object","defineProperty","get","console","log","set","Observer","data","walk","value","entries","observe","vm","exp","_data","_proxy","keys","newData","initData","call","initWatch","watch","length","Watcher","Vue","options","$options","prototype","$watch"],"mappings":"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"}